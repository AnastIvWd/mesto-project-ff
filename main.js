(()=>{"use strict";function e(e,r){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,c,a,i=[],u=!0,s=!1;try{if(c=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=c.call(r)).done)&&(i.push(n.value),i.length!==t);u=!0);}catch(e){s=!0,o=e}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(s)throw o}}return i}}(e,r)||function(e,r){if(e){if("string"==typeof e)return t(e,r);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?t(e,r):void 0}}(e,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var r={baseUrl:"https://mesto.nomoreparties.co/v1/wff-cohort-16",headers:{authorization:"86302fd8-e8eb-43c3-b292-e51885ed2960","Content-Type":"application/json"}},n=document.querySelector("#card-template").content;function o(e){e.target.classList.toggle("card__like-button_is-active")}function c(e){e.target.closest(".places__item").remove()}function a(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",s)}function i(e){e.classList.remove("popup_is-opened"),u(e,!1),document.removeEventListener("keydown",s)}function u(e,t){e.querySelector(".popup__button").textContent=t?"Сохранение...":"Сохранить"}function s(e){"Escape"===e.key&&(i(document.querySelector(".popup_is-opened")),document.removeEventListener("keydown",s))}function l(e){var t=e.target.classList.contains("popup__close"),r=!e.target.closest(".popup__content");(t||r)&&(i(e.currentTarget),document.removeEventListener("keydown",s))}var d,p=function(e,t,r){var n=t.querySelector(".".concat(r.id,"-error"));r.classList.remove(e.inputErrorClass),n.classList.remove(e.errorClass),n.textContent=""},f=function(e,t,r){!function(e){return e.some((function(e){return!e.validity.valid}))}(t)?(r.disabled=!1,r.classList.remove(e.inactiveButtonClass)):(r.disabled=!0,r.classList.add(e.inactiveButtonClass))},_=function(e,t){Array.from(t.querySelectorAll(e.inputSelector)).forEach((function(r){p(e,t,r)}))},m={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"form__submit_inactive",inputErrorClass:"form__input_type_error",errorClass:"form__input_type_error-active"},v=document.querySelector(".places__list"),y=document.querySelector(".profile__edit-button"),h=document.querySelector(".popup_type_edit"),b=document.querySelector(".profile__title"),S=document.querySelector(".profile__description"),k=h.querySelector(".popup__form"),g=k.querySelector(".popup__input_type_name"),q=k.querySelector(".popup__input_type_description"),C=document.querySelector(".profile__add-button"),E=document.querySelector(".popup_type_new-card"),L=document.querySelector(".popup_type_image"),j=L.querySelector(".popup__image"),A=L.querySelector(".popup__caption"),x=E.querySelector(".popup__form"),P=x.querySelector(".popup__input_type_card-name"),w=x.querySelector(".popup__input_type_url"),U=document.querySelector(".profile__image"),T=document.querySelector(".popup_type_avatar"),O=T.querySelector(".popup__form"),M=document.querySelector(".avatar__edit-button"),B=T.querySelector(".popup__input_type_url");function D(e,t){v.prepend(function(e){var t=e.item,o=e.deleteCard,c=e.openCardModalImage,a=e.handleLike,i=e.user,u=n.querySelector(".places__item").cloneNode(!0),s=u.querySelector(".card__image"),l=u.querySelector(".card__title"),d=u.querySelector(".card__like-button"),p=u.querySelector(".number-likes"),f=t.likes,_=f.find((function(e){return e._id===i._id}));if(s.setAttribute("src",t.link),s.setAttribute("alt",t.name),l.textContent=t.name,p.textContent=t.likes.length,s.addEventListener("click",c),d.addEventListener("click",(function(e){var n;e.target.classList.contains("card__like-button_is-active")?(n=t._id,fetch("".concat(r.baseUrl,"/cards/likes/").concat(n),{method:"DELETE",headers:r.headers}).then((function(e){return e.ok?e.json():Promise.reject("Запрос: ".concat(e.status))})).catch((function(e){console.error(e)}))).then((function(t){p.textContent=t.likes.length,f=t.likes,a(e)})):function(e){return fetch("".concat(r.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:r.headers}).then((function(e){return e.ok?e.json():Promise.reject("Запрос: ".concat(e.status))})).catch((function(e){console.error(e)}))}(t._id).then((function(t){p.textContent=t.likes.length,f=t.likes,a(e)}))})),t.owner._id===i._id){var m=document.createElement("button");m.setAttribute("class","card__delete-button"),m.addEventListener("click",(function(e){var n;o(e),n=t._id,fetch("".concat(r.baseUrl,"/cards/").concat(n),{method:"DELETE",headers:r.headers}).then((function(e){return e.ok?e.json():Promise.reject("Запрос: ".concat(e.status))})).catch((function(e){console.error(e)}))})),u.appendChild(m)}return _&&d.classList.toggle("card__like-button_is-active"),u}({item:e,deleteCard:c,openCardModalImage:I,handleLike:o,user:t}))}function I(e){j.setAttribute("src",e.target.src),j.setAttribute("alt",e.target.alt),A.textContent=e.target.alt,a(L)}Promise.all([fetch("".concat(r.baseUrl,"/cards"),{headers:r.headers}),fetch("".concat(r.baseUrl,"/users/me"),{headers:r.headers})]).then((function(t){var r=e(t,2),n=r[0],o=r[1];return n.ok&&o.ok?Promise.all([n.json(),o.json()]):Promise.reject("Запрос 1: ".concat(n.status," Запрос 2: ").concat(o.status))})).then((function(t){var r=e(t,2);return{cards:r[0],user:r[1]}})).then((function(e){var t=e.cards,r=e.user;t.forEach((function(e){D(e,r)})).catch((function(e){console.error(e)})),b.textContent=r.name,S.textContent=r.about,U.style='background-image: url("'.concat(r.avatar,'")')})),d=m,document.querySelectorAll(d.formSelector).forEach((function(e){!function(e,t){var r=Array.from(t.querySelectorAll(e.inputSelector)),n=t.querySelector(e.submitButtonSelector);f(e,r,n),r.forEach((function(o){o.addEventListener("input",(function(){!function(e,t,r){r.validity.patternMismatch?r.setCustomValidity(r.dataset.errorMessage):r.setCustomValidity(""),r.validity.valid?p(e,t,r):function(e,t,r,n){var o=t.querySelector(".".concat(r.id,"-error"));r.classList.add(e.inputErrorClass),o.textContent=n,o.classList.add(e.errorClass)}(e,t,r,r.validationMessage)}(e,t,o),f(e,r,n)}))}))}(d,e)})),y.addEventListener("click",(function(){a(h),g.value=b.textContent,q.value=S.textContent,_(m,k)})),h.addEventListener("click",l),k.addEventListener("submit",(function(e){e.preventDefault();var t,n,o=g.value,c=q.value;u(k,!0),(t=o,n=c,fetch("".concat(r.baseUrl,"/users/me"),{method:"PATCH",headers:r.headers,body:JSON.stringify({name:t,about:n})}).then((function(e){return e.ok?e.json():Promise.reject("Запрос: ".concat(e.status))})).catch((function(e){console.error(e)}))).then((function(e){b.textContent=e.name,S.textContent=e.about,i(h)}))})),M.addEventListener("click",(function(){a(T),B.value="",_(m,O)})),O.addEventListener("submit",(function(e){e.preventDefault();var t,n=B.value;u(T,!0),(t=n,fetch("".concat(r.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:r.headers,body:JSON.stringify({avatar:t})}).then((function(e){return e.ok?e.json():Promise.reject("Запрос: ".concat(e.status))})).catch((function(e){console.error(e)}))).then((function(e){U.style='background-image: url("'.concat(e.avatar,'")'),i(T)}))})),T.addEventListener("click",l),C.addEventListener("click",(function(){a(E),P.value="",w.value="",_(m,x)})),E.addEventListener("click",l),x.addEventListener("submit",(function(e){var t,n;e.preventDefault(),u(E,!0),(t=P.value,n=w.value,fetch("".concat(r.baseUrl,"/cards"),{method:"POST",headers:r.headers,body:JSON.stringify({name:t,link:n})}).then((function(e){return e.ok?e.json():Promise.reject("Запрос: ".concat(e.status))})).catch((function(e){console.error(e)}))).then((function(e){D(e,!0),i(E)}))})),L.addEventListener("click",l)})();